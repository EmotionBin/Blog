# 前端性能优化

作为一个用户，对网页的性能肯定特别敏感，如果遇到了一个性能很差的网页，比如白屏等待时间长，操作不流畅，卡顿等现象，那么肯定就不会有继续浏览下去的欲望了，直接点击右上角走人。因此，web 性能也是我们开发者比较关注的一个方面，前端攻城狮也必须要掌握一些 web 性能优化的技能，这样才能让网页有着更流畅，更极致的用户体验  

----

## 资源加载优化

一个 web 网页从获取到完成渲染大致需要经过以下几个步骤，DNS解析、获取资源、生成渲染树、绘制到网页上，资源加载优化主要就是对这个 web 网页的所有资源的获取优化，把各种资源的获取时间尽可能的压缩到最低，这样就可以在短时间内拿到页面中的各种资源，并完成渲染，呈现出页面  

----

### 减小资源体积

网页中的资源主要有 HTML、CSS、JS 以及一些图片字体资源组成，如果他们的体积太大，要加载的资源就会非常多，加载的速度就会很慢，但是如果他们的体积足够小(在不影响功能的前提下)，就可以提高网页的加载速度了，以下给出了几种减小资源体积的方法：  

1. 对 HTML、CSS、JS 等资源进行压缩，去除注释、空行等，把所有代码压缩成一行，对 JS 还可以进行混淆变量的操作
2. 对一些图片资源，可以进行压缩，比如使用[熊猫压缩](https://tinypng.com)，但是压缩后图片清晰度会下降，根据实际情况进行权衡
3. 服务端开启 GZIP 压缩，使文件以 GZIP 格式使用

前面两点是指对资源的内容进行压缩，精简内容，第三点是对文件格式就行压缩，可以这样理解，前面两点的操作是把各种资源进行简化后，得到精简版的文件，第三点是把前面得到的精简版文件生成压缩文件，也就是我们常见的压缩包的形式，这些压缩方法通过一些打包工具(如 webpack)都是可以实现的  

----

### 使用缓存

对于 web 网页来说，缓存可以提升页面性能，同时减少服务器压力。缓存的种类有两大类，强缓存和协商缓存，需要根据实际情况决定使用强缓存还是协商缓存，用了缓存的确能提高加载资源的速度，但是如果滥用缓存，则会导致资源无法及时更新，所以应该**合理使用浏览器缓存**  

----

### 使用 CDN

CDN 的全称是内容分发网络，它是一个服务器集群，当我们要请求我们想要的资源的时候，CDN 会根据特定的算法筛选出一个能最快给我们响应的服务器，然后将指定资源返回。因此我们可以利用 CDN 获取一些第三方库资源，自己的服务器只部署剩余的资源，这样不仅能缓解我们服务器的压力，还可以提高页面性能  

----

### 减少 HTTP 请求

HTTP 请求是获取页面资源的手段，同时也是影响页面性能的重要因素之一，所以要尽量的减少一些不必要的 HTTP 缓存，以下给出几种方案：  

1. 合并资源，一些第三方库资源整合到一个文件中，通过一次 HTTP 请求全部获取
2. 对于 10kb 以下的图片资源可以采用 base64 格式存储在内存中，不必再向服务器请求获取

对于第一点合并资源，它也会带来一定的弊端，缓存失效和首屏渲染问题，因为所有资源都整合到了一个文件，如果我只改动了很微小的一部分，那么必须要重新获取这一整个文件；如果是 SPA 单页面应用则可能会造成首屏渲染时间过长的问题，所以给出解决方案是：**只把第三方库资源合并在一起**  

对于第二点，小图片采用了 base64 格式存储确实减少了 HTTP 请求，但是使用 base64 格式会导致图片的体积增大，这也是需要权衡的因素  

----

### 文件拆分

文件拆分常常用于 SPA 单页面应用的首屏渲染时间过长的场景，可以把文件拆分成一个路由对应一个 JS 文件，同时配合上**路由懒加载**，这样一来，在首页的时候，只需要加载首页所用到的资源，切换到其他路由的时候，再去加载其他页面所用到的资源，这样可以把加载时间平均分配到各个页面，解决了首屏渲染时间过长的问题  

----

### DNS 预解析

DNS 预解析也是前端优化中的一部分，即利用空闲时间提前解析，域名解析是耗时间的，使用 DNS 预解析可以有效的降低 DNS 解析的延迟，下面给出开启预解析的方法：  

在 HTML 的 HEAD 中加入以下内容即可：  

**1.当前页面要做DNS预解析**

```html
<!-- on 表示开启，若想关闭则改为 off 即可 -->
<meta http-equiv="x-dns-prefetch-control" content="on">
```

**2.强制查找特定的主机名：**  

```html
<!-- 在此示例中，域名“ www.mozilla.org/contribute ”将被预先解析 -->
<link rel="dns-prefetch" href="https://www.mozilla.org/contribute/">
```

一些浏览器会对 a 标签的 `href` 自动启用 DNS 预解析，所以 a 标签里包含的域名不需要在 HEAD 中手动设置 LINK。但是在 HTTPS 下不起作用，需要 META 来强制开启功能，更多详细配置可以参考 [MDN X-DNS-Prefetch-Control](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control)  

----

## 资源渲染优化

资源渲染优化是指拿到一个页面中的所有资源后，对页面资源的呈现过程进行优化，侧重点在渲染的过程  

----

### 减少 DOM 操作

DOM 操作是很耗性能的，某些 DOM 属性(如 `offsetTop`、`scrollTop`)的读取还会触发浏览器的**重排**操作，一旦 DOM 操作多了，对网页的性能将会有很大的影响，所以应该尽可能的减少 DOM 操作  

----

### 优化关键渲染路径

关键渲染路径是浏览器将 HTML、CSS、JS 转换为在屏幕上呈现的像素内容所经历的一系列步骤，为了优化关键渲染路径，给出了以下几种方案：  

1. CSS 放在 HEAD 中，与页面加载无关的 JS 放 BODY 后
2. 行内脚本(script 标签引入)根据情况使用 async 或 defer 进行异步加载

----

### 懒加载

当数据量大的时候，为了页面的性能考虑，是有必要使用懒加载渲染的，懒加载指的就是，在需要时加载，比如 SPA 单页面应用的首屏问题，首屏的时候只加载首屏对应的内容，切换路由时再加载该路由对应的内容；还有假如后端一次性给你了几万条数据，这时候也是有必要使用懒加载的，懒加载的例子还有很多，比如图片懒加载、路由懒加载、滚动加载、下拉刷新加载等  

----

### 防抖和节流

防抖和节流也是前端性能优化中常用的手段，常见于需要频繁触发某一事件的场景，可以有效的控制事件触发的频率和时间，极大提高了页面性能  

----

### 减少浏览器重绘和重排(回流)

如果只修改了元素的颜色会触发浏览器的重绘，如果修改了元素尺寸或位置会触发浏览器的重排(也叫回流)，重排的性能消耗要比重绘大得多，所以应该尽量减少浏览器的重绘和重排  

----

## 结束语

以上就是关于前端性能优化的一些内容。如果本文中有说的不正确的地方，欢迎大佬鞭策!  

**参考资料：**

[前端性能优化总结](https://segmentfault.com/a/1190000017556203)  
[网页性能管理详解](http://www.ruanyifeng.com/blog/2015/09/web-page-performance-in-depth.html)  
[页面性能优化办法有哪些？](https://segmentfault.com/a/1190000016745587)




